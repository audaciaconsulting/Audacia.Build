# Job template to deploy to a specific environment
parameters:
  projectPaths: 
    type: string
    default: ''
  allowedLicenses: 
    type: object
    default:
      - MIT
      - Apache
      - BSD

steps:
  - script: |
      dotnet new tool-manifest
      dotnet tool install dotnet-project-licenses
    name: ${{ parameters.name }}
    displayName: Install license check dotnet tool

  - task: PowerShell@1
    displayName: "Process Allowed Licenses and Mappings"
    inputs:
      targetType: 'inline'
      script: |
        $licenses = @${{ parameters.allowedLicenses }}
        $licensesPath = "$(Agent.TempDirectory)/allowed-licenses.json"
        $licenses | ConvertTo-Json -Depth 100 | Out-File -Encoding UTF8 $licensesPath

        dotnet tool run dotnet-project-licenses `
          -i '${{ parameters.projectPath }}' `
          -t `
          --use-project-assets-json `
          --allowed-license-types "$licensesPath"
