# Job template to deploy to a specific environment
parameters:
  projectPaths: 
    type: string
    default: ''
  allowedLicenses: 'MIT;Apache-2.0;BSD-3-Clause'
    # type: Object
    # default:
    #   - MIT
    #   - Apache
    #   - BSD

steps:
  - script: |
      dotnet new tool-manifest
      dotnet tool install dotnet-project-licenses
    name: ${{ parameters.name }}
    displayName: Install license check dotnet tool

  - task: PowerShell@1
    displayName: "Process Allowed Licenses and Mappings"
    inputs:
      targetType: 'inline'
      script: |
        Write-Host "Before $licenses"
        $licenses = 'MIT;Apache-2.0;BSD-3-Clause'
        Write-Host "After $licenses"
        $licensesPath = "$(Agent.TempDirectory)/allowed-licenses.json"
        Write-Host "After $licensesPath"
        $licenses | ConvertTo-Json -Depth 100 | Out-File -Encoding UTF8 $licensesPath
        Write-Host "After $licenses 2"

        dotnet tool run dotnet-project-licenses `
          -i '${{ parameters.projectPaths }}' `
          -t `
          --use-project-assets-json `
          --allowed-license-types "$licensesPath"
