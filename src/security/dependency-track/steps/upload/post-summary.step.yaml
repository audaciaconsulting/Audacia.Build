# Step: Create and publish a Markdown summary from uploaded rows
steps:
  - task: PowerShell@2
    displayName: "Upload summary"
    inputs:
      pwsh: true
      targetType: inline
      script: |
        $ErrorActionPreference='Stop'

        $rowsPath = Join-Path $env:AGENT_TEMPDIRECTORY 'dt-uploaded-rows.json'
        $rows = @()
        if (Test-Path -LiteralPath $rowsPath) {
          try { $rows = Get-Content -Raw -LiteralPath $rowsPath | ConvertFrom-Json } catch { $rows=@() }
        }
        if ($rows -isnot [System.Collections.IEnumerable]) { $rows = @($rows) }
        if (-not $rows) { $rows = @() }

        # ---- Console output (grouped) ----
        Write-Host "##[group]Dependency-Track Upload Summary (console)"
        Write-Host ("Total Projects: {0}" -f $rows.Count)
        if ($rows.Count -gt 0) {
          # Emit a compact table to STDOUT for unfamiliar readers following the live log
          "{0,-50} {1,-30}" -f "Project","Version" | Write-Host
          "{0,-50} {1,-30}" -f "-------","-------" | Write-Host
          foreach ($r in $rows) {
            "{0,-50} {1,-30}" -f ([string]$r.Project), ([string]$r.Version) | Write-Host
          }
        } else {
          Write-Host "_No projects to list._"
        }
        Write-Host "##[endgroup]"
        # Markdown summary and file upload removed as requested
