# Template: download SBOM artifact and upload via Dependency-Track API.
parameters:
  # Name of the artifact to download (produced by generate-sbom template).
  - name: artifactName
    type: string
    default: 'sbom-files'

  # If true: fail the job when any upload fails.
  # Recommendation: true in mainline; false in exploratory/dry-run scenarios.
  - name: failOnUploadError
    type: boolean
    default: true

steps:
  # Step 1: Download SBOM artifact
  - template: /src/security/dependency-track/steps/upload/download-sbom-artifact.step.yaml@templates
    parameters:
      artifactName: ${{ parameters.artifactName }}

  # Step 2: Build project tags from environment variables
  - template: /src/security/dependency-track/steps/upload/build-project-tags.step.yaml@templates

  # Step 3: Discover SBOM files and create JSON array
  - template: /src/security/dependency-track/steps/upload/discover-sbom-files.step.yaml@templates

  # Step 4: Upload SBOMs to Dependency-Track
  - template: /src/security/dependency-track/steps/upload/upload-sboms.step.yaml@templates
    parameters:
      failOnUploadError: ${{ parameters.failOnUploadError }}
