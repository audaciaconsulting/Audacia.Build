# Template: publish SBOM artifact (conditional on publishArtifact parameter)
parameters:
  - name: publishArtifact
    type: boolean
    default: true
  - name: artifactName
    type: string
    default: 'sbom-files'

steps:
  # Primary publish when enabled
  - ${{ if eq(parameters.publishArtifact, true) }}:
      - task: PublishPipelineArtifact@1
        displayName: "Publish SBOM artifact"
        inputs:
          targetPath: "$(Agent.TempDirectory)/sbom"
          publishLocation: pipeline
          artifact: ${{ parameters.artifactName }}

  # Fallback publish only when publishArtifact=false but SBOMs exist
  - task: PublishPipelineArtifact@1
    displayName: "Publish SBOM artifact (fallback)"
    condition: and(
      succeeded(),
      eq(variables['sbomExists'], 'true'),
      eq('${{ parameters.publishArtifact }}','false')
      )
    inputs:
      targetPath: $(Agent.TempDirectory)/sbom
      publishLocation: pipeline
      artifact: ${{ parameters.artifactName }}
